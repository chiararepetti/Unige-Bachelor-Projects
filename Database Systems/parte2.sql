DROP SCHEMA IF EXISTS "socialmarket" cascade;
CREATE SCHEMA IF NOT EXISTS "socialmarket";
SET search_path to "socialmarket";
SET datestyle to "MDY";

CREATE TABLE Persone(
	Cod_Fisc VARCHAR(20) PRIMARY KEY,
	Nome VARCHAR(30) NOT NULL,
	Cognome VARCHAR(30) NOT NULL,
	Luogo_nasc VARCHAR(30) NOT NULL,
	Data_nasc DATE NOT NULL,
	Indirizzo VARCHAR(30) NOT NULL,
	Telefono DECIMAL(10),
	Mail VARCHAR(50)
);


CREATE TABLE Nuclei_Familiari(
  	Cod_Fam VARCHAR(5) PRIMARY KEY,
	Punti_mensili DECIMAL(2) CHECK(Punti_mensili BETWEEN 30 AND 60),
	Titolare VARCHAR(30) NOT NULL
);


CREATE TABLE Clienti(
	Cod_Fisc VARCHAR(20) PRIMARY KEY
	REFERENCES Persone
	(Cod_Fisc) ON UPDATE CASCADE,
	Cod_Fam VARCHAR(5),
	FOREIGN KEY(Cod_Fam)
	REFERENCES Nuclei_Familiari(Cod_Fam),
	Ente VARCHAR (30) NOT NULL,
	Data_inizio DATE NOT NULL,
	Abilitato BOOLEAN NOT NULL DEFAULT FALSE,
	Reddito DECIMAL (5),
	Fasce VARCHAR(20) NOT NULL
);


CREATE TABLE Volontari(
	Id_Vol VARCHAR(20) PRIMARY KEY
	REFERENCES Persone
	(Cod_Fisc) ON UPDATE CASCADE,
	Veicolo VARCHAR(30),
	Disponibilità VARCHAR(60) NOT NULL,
	Trasporto BOOLEAN NOT NULL DEFAULT FALSE,
	Appuntamento BOOLEAN NOT NULL DEFAULT FALSE,
	Scarico BOOLEAN NOT NULL DEFAULT FALSE,
	Associazione VARCHAR(30)
);


CREATE TABLE Appuntamenti(
	Cod_App VARCHAR(8) PRIMARY KEY,
	Data_ora TIMESTAMP NOT NULL,
	Id_Cl VARCHAR(20) NOT NULL,
	Id_Vol VARCHAR(20) NOT NULL,
	FOREIGN KEY(Id_Vol)
	REFERENCES Volontari(Id_Vol),
	FOREIGN KEY(Id_Cl)
	REFERENCES Clienti(Cod_Fisc)
);


CREATE TABLE Inventario(
	Cod_Prod VARCHAR(30),
	Data_Scad DATE,
	Quantità DECIMAL(4),
	Num_Punti DECIMAL(2) NOT NULL,
	Limite_max DATE,
	Tipologia VARCHAR(20) NOT NULL,
	Deperibile BOOLEAN default TRUE,
	PRIMARY KEY(Cod_Prod,Data_Scad)
);

CREATE TABLE Enti(
	CF VARCHAR(20) PRIMARY KEY,
	Nome VARCHAR(30) NOT NULL,
	Tipo VARCHAR(30) NOT NULL,
	Indirizzo VARCHAR(30) NOT NULL,
	Telefono DECIMAL(10) NOT NULL
);


CREATE TABLE Donazioni(
	Cod_Donazione VARCHAR(8) PRIMARY KEY,
	Cod_Donatore VARCHAR(20), 
	FOREIGN KEY(Cod_Donatore)
	REFERENCES Persone(Cod_Fisc),
	Cod_Es VARCHAR(20),
	FOREIGN KEY(Cod_Es)
	REFERENCES Enti(CF),
	Importo DECIMAL (8),
	Data_ora TIMESTAMP NOT NULL
);


CREATE TABLE ProdottiEntrata(
	Cod_Prod VARCHAR(30),
	Data_Scad DATE,
	Data_Ent timestamp NOT NULL,
	Ricevente VARCHAR(20) REFERENCES Volontari
	(Id_Vol) ON UPDATE CASCADE,
	Consegna VARCHAR(20) REFERENCES Volontari
	(Id_Vol) ON UPDATE CASCADE,
	Tipologia VARCHAR(20) NOT NULL,
	Cod_don VARCHAR(8) REFERENCES Donazioni
	(Cod_Donazione) ON UPDATE CASCADE,
	FOREIGN KEY(Cod_Prod,Data_Scad)
	REFERENCES Inventario(Cod_Prod,Data_Scad),
	PRIMARY KEY (Cod_Prod,Data_Scad,Data_Ent)
);


CREATE TABLE ProdottiUscita(
	Cod_App VARCHAR(8),
	Cod_Prod VARCHAR(30),
	Data_Scad DATE,
	Quantità DECIMAL(4) NOT NULL,
	FOREIGN KEY(Cod_Prod,Data_Scad)
	REFERENCES Inventario(Cod_Prod,Data_Scad),
	FOREIGN KEY(Cod_App)
	REFERENCES Appuntamenti(Cod_App),
	PRIMARY KEY (Cod_App,Cod_Prod,Data_Scad)
);


CREATE TABLE Trasporti(
	Id_Trasporto VARCHAR(8),
	Id_Vol VARCHAR(20),
	Num_Cestelli DECIMAL(2) NOT NULL,
	Sede VARCHAR(30) NOT NULL,
	Data_ora timestamp NOT NULL,
	FOREIGN KEY(Id_Vol)
	REFERENCES Volontari(Id_Vol),
	PRIMARY KEY (Id_Trasporto,Id_Vol)
);


create table ScaricoProdotti(
	Cod_Prod varchar(30),
	Data_Scad date,
	DataScar timestamp not NULL,
	Numcestelli decimal(2) DEFAULT 1,
	Quantità decimal(4) NOT NULL,
	FOREIGN KEY(Cod_Prod,Data_Scad)
	REFERENCES Inventario(Cod_Prod,Data_Scad),
	primary key (Cod_Prod,DataScar,Data_Scad)
);


/*Popolamento database */
INSERT INTO Persone VALUES('GRZCLL00D64I138Y','Camilla','Graziani','La Spezia','04/24/2000','Via Del Lago 369',3450882066,
                          'camitop@gmail.com');
INSERT INTO Persone VALUES('GRZCHR97C50I323C','Chiara','Graziani','La Spezia','08/10/1997','Via Del Lago 369',3329091234);
INSERT INTO Persone VALUES('PSCMRZ50B25I909F','Maurizio','Pisciottu','Olbia','02/25/1950','Via Del Lago 369',3451234112);
INSERT INTO Persone VALUES('GRBLGG60T12U123E','Luigi','Garibaldi','Roma','09/12/1960','Via dei Mille',3331111222);
INSERT INTO Persone VALUES('RRNZRR97A21I134C','Zoro','Roronoa','Siracusa','01/21/1997','Via degli Spadaccini 2',3334569012);
INSERT INTO Persone VALUES('RMNPTR08S06E625V','Pietro','Armani','Livorno','11/06/2012','Via dei Portieri 1');
INSERT INTO Persone VALUES('RMNFRN78C29T789E','Franco','Armani','Potenza','03/24/1978','Via dei Portieri 1',3456788890);
INSERT INTO Persone VALUES('MDSLSS00D24D969E','Alessandro','Modesti','Genova','04/24/2000','Via delle donne 23',3456789012);
INSERT INTO Persone VALUES('MDSGLC96M10I138S','Gianluca','Modesti','Sanremo','08/10/1996','Via delle donne 23',3450001234,
						   'gianlucmode@gmail.com');
INSERT INTO Persone VALUES('DNLNTN68A41I138O','Antonia','Daniele','Sanremo','10/18/1960','Via delle donne 23',3338981731,
						  'antoniadaniele@yahoo.it');
INSERT INTO Persone VALUES('TRFGTR09D23I123E','Getro','Terrafano','Palermo','10/25/2009','Via Pianale 23',3347280661,
                          'TerrafanoGetro@libero.it');
INSERT INTO Persone VALUES('SCSGNN80E10D969E','Gianni','Soscara','Catanzaro','05/10/1980','Via Scale 344',3453453451,
						  'giannisoscara@libero.it');
INSERT INTO Persone VALUES('MRRFBB70A1I138V','Fabio','Marra','Palermo','10/18/1970','Via Peiranze 12',3456789010);
INSERT INTO Persone VALUES('MGGNCL00B24D969E','Nicola','Maggi','Genova','02/24/2000','Via del Grano 123',3395623077);
INSERT INTO Persone VALUES('PSQGLL99E54I138T','Giulia','Pasquali','Imperia','05/14/1999','Via Natale 2',3335556660);
INSERT INTO Persone VALUES('BRDDMNA25B347TGT','Domenico','Berardi','Sassuolo','10/25/1994','Via Mapei 3',3331112223);
INSERT INTO Persone VALUES('LGBVTT67E13I567D','Vittorio','Ligabue','Milano','05/13/1967','Via del Fieno 123',3453453451);
INSERT INTO Persone VALUES('FRNMRA80A01I480M','Mario','Franchetti','Savona','10/18/1980','Via delle Rose 16',3339190902);
INSERT INTO Persone VALUES('LNFGRG51L07A089L','Lanfranco','Giorgio','Agrigento','07/07/1951','Via Garibaldi 2');
INSERT INTO Persone VALUES('DNLCRS00A25I138V','Daniele','Christian','Sanremo','10/25/2000','Via Due Cammini 47',3383952930,
						  'christian.daniele25@gmail.com');
INSERT INTO Persone VALUES('RPTCHR01S56D969C','Chiara','Repetti','Genova','11/16/2001','Via sestri 13',3451096104,
						  'chiarep@gmail.com');
INSERT INTO Persone VALUES('PDRLRN978DK37FB5','Lorenzo','Pedrotti','Perugia','05/26/1997','Via saltimbanco 33',3856734222,
						  'lollo.pedro@gmail.com');
INSERT INTO Persone VALUES('FVRFRN99JE9CSL4V','Francesca','Favretto','Napoli','09/15/1999','Via ottonello 12/4',3942723459,
						  'cesca.favra@gmail.com');
INSERT INTO Persone VALUES('FRRLRN02H40ZL3NF','Lorenzo','Ferri','Cesena','03/22/2002','Via della liberazione 69',3319367894,
						  'sasso@gmail.com');
INSERT INTO Persone VALUES('CSTAMD95AL20C6BN','Amedeo','Costosi','Bari','08/08/1995','Via lame corte 25',3337654655,
						  'AmePrex@gmail.com');
INSERT INTO Persone VALUES('PRSCHR11P0A7CL3H','Chiara','Prossenica','Genova','11/11/2011','Via sestri levante 13',3985689063,
						  'chiapross@gmail.com');
INSERT INTO Persone VALUES('FBRFBR769FB3IX8F','Fabrizio','Fibroga','Milano','07/25/1956','Via dei carpentieri 7',2127298783,
						  'FabriFibra@gmail.com');
INSERT INTO Persone VALUES('SLLGCM00Y5C8LA7D','Geicomo','Sollazzi','Busalla','12/25/2000','Via del nomade 31',5168661392,
						  'geicc@gmail.com');
INSERT INTO Persone VALUES('CNTLBR98IC8F40G7','Alberto','Contatori','Grenoble','09/29/1998','Via mausoleo 28',1862472507,
						  'Albecontador@gmail.com');
INSERT INTO Persone VALUES('FBBMTT05LAIW4V20','Matteo','Fabbro','Trento','03/22/2005','Viale vesuvio 2',5651158863,
						  'matteux@gmail.com');
INSERT INTO Persone VALUES('WNNCLB93LE49C7V0','Caleb','Ewan','Salerno','08/13/1993','Via della vittoria 16',2667773267,
						  'CB93@gmail.com');
INSERT INTO Persone VALUES('MRGSLV018D7GL37S','Silvia','Morigalli','Palermo','02/28/2001','Via sentinelle 45',7791224977,
						  'SM@gmail.com');
INSERT INTO Persone VALUES('GCBCRS92ISYFN3F8','Cristina','Giacobazzi','Udine','07/13/1992','Via delle perle 28',7282769283,
						  'GC@gmail.com');
INSERT INTO Persone VALUES('CNTSFA87IFDUVBS1','Sofia','Cantello','Genova','12/30/1987','Via dei maniscalchi',7781692514,
						  'SC@gmail.com');
INSERT INTO Persone VALUES('FBBDRA00S8DBHDTF','Dario','Fabbretti','Bergamo','12/30/2000','Viale gamberi',7781692517,
						  'DarioneSpaccatutto@gmail.com');
INSERT INTO Persone VALUES('JDBCKA76NCJD84GO','Jadie','Backi','Bologna','10/22/2003','Via lingotto 6',7785692517,
						  'JB@gmail.com');
INSERT INTO Persone VALUES('RSSLSN80R09L219E','Alessandro','Rossi','Torino','10/09/1980','Via Multedo 4',393065233,'ale.rossi@gmail.com');
INSERT INTO Persone VALUES('RSSDRD99M12D969S','Edoardo','Rossi','Genova','08/12/1999','Via Multedo 4',300929902,'edomarino@gmail.com');
INSERT INTO Persone VALUES('FRRMME10B56D969Q','Emma','Ferrari','Genova','02/16/2010','Via Montella 23',375344329,NULL);
INSERT INTO Persone VALUES('CSTBRC01H49F205L','Beatrice','Costa','Genova','06/09/2001','Viale Modugno 46',320197814,'beatrix.costa@gmail.com');
INSERT INTO Persone VALUES('BNCTRS72D59D969K','Teresa','Bianchi','Genova','04/19/1972','Viale Modugno 32',332074417,'terribibi@gmail.com');
INSERT INTO Persone VALUES('FGGLNZ83T06D969Q','Lorenzo','Foggia','Genova','12/06/1983','Via Arrivabene 46',341030060,'fontalori@gmail.com');
INSERT INTO Persone VALUES('FRRLNE00R42D969M','Elena','Ferrari','Genova','10/02/2000','Via Montella 23',349503791,'eleferrara@gmail.com');
INSERT INTO Persone VALUES('SRRNNA95C68D969V','Anna','Serra','Genova','03/28/1995','Corso Firenza 70',341150292,'anna.serra@gmail.com');
INSERT INTO Persone VALUES('SPSNTN73P07F839L','Antonio','Esposito','Genova','09/07/1973','Via Montella 23',340094178,'expo.anto@gmail.com');
INSERT INTO Persone VALUES('FNTDRA84E22H501G','Dario','Fontana','Roma','05/22/1984','Via Paolo Frisi 37',347238844,'dado.fonta@gmail.com');
INSERT INTO Persone VALUES('MRLSRG65D14D969D','Sergio','Morelli','Genova','04/14/1965','Corso Monte Grappa 9',338607569,'sergiomorelli@gmail.com');
INSERT INTO Persone VALUES('CLMMGH98H59F839G','Margherita','Colombo','Napoli','06/19/1998','Via Federico Fellini 75',358376580,'maggycolombo@gmail.com');
INSERT INTO Persone VALUES('RSSCRN19L65G273P','Caterina','Rossi','Genova','07/25/2019','Via Multedo 4',NULL,NULL);
INSERT INTO Persone VALUES('RZZFNC75M01B354P','Francesco','Rizzi','Cagliari','08/01/1975','Via Santa Margherita 96',383746404,'Rizzi.fra75@gmail.com');

INSERT INTO Nuclei_Familiari VALUES('f0001',30,'Maurizio Pisciottu');
INSERT INTO Nuclei_Familiari VALUES('f0002',50,'Luigi Garibaldi');
INSERT INTO Nuclei_Familiari VALUES('f0003',35,'Franco Armani');
INSERT INTO Nuclei_Familiari VALUES('f0004',30,'Antonia Daniele');
INSERT INTO Nuclei_Familiari VALUES('f0005',30,'Christian Daniele');
INSERT INTO Nuclei_Familiari VALUES('f0006',37,'Lorenzo Pedrotti');
INSERT INTO Nuclei_Familiari VALUES('f0007',35,'Francesca Favretto');
INSERT INTO Nuclei_Familiari VALUES('f0012',41,'Lorenzo Ferri');
INSERT INTO Nuclei_Familiari VALUES('f0013',35,'Amedeo Costosi');
INSERT INTO Nuclei_Familiari VALUES('f0008',30,'Fabrizio Fibroga');
INSERT INTO Nuclei_Familiari VALUES('f0009',47,'Geicomo Sollazzi');
INSERT INTO Nuclei_Familiari VALUES('f0010',45,'Dario Fabbretti');
INSERT INTO Nuclei_Familiari VALUES('f0011',47,'Jadie Backi');
INSERT INTO Nuclei_Familiari VALUES('f0015',31,'Lorenzo Foggia');
INSERT INTO Nuclei_Familiari VALUES('f0016',37,'Antonio Esposito');
INSERT INTO Nuclei_Familiari VALUES('f0014',42,'Alessandro Rossi');

INSERT INTO Clienti VALUES ('GRZCLL00D64I138Y','f0001','Caritas','07/01/2023',TRUE,NULL,'14-60');
INSERT INTO Clienti VALUES ('GRZCHR97C50I323C','f0001','Caritas','07/02/2023',TRUE,NULL,'14-60');
INSERT INTO Clienti VALUES ('PSCMRZ50B25I909F','f0001','Caritas','06/01/2023',TRUE,8000,'60+');
INSERT INTO Clienti VALUES ('GRBLGG60T12U123E','f0002','Humanitas', '08/08/2023',TRUE,5000,'60+');
INSERT INTO Clienti VALUES ('RRNZRR97A21I134C','f0002','Humanitas', '08/08/2023',TRUE,NULL,'14-60');
INSERT INTO Clienti VALUES ('RMNPTR08S06E625V','f0003','HelpTogheter','06/22/2023',FALSE,NULL,'06-14');
INSERT INTO Clienti VALUES ('RMNFRN78C29T789E','f0003','HelpTogheter','06/15/2023',TRUE,6000,'14-60');
INSERT INTO Clienti VALUES ('DNLNTN68A41I138O','f0004','CariRoma','07/07/2023',TRUE,6500,'60+');
INSERT INTO Clienti VALUES ('MDSGLC96M10I138S','f0004','CariRoma','07/10/2023',TRUE,5000,'14-60');
INSERT INTO Clienti VALUES ('MDSLSS00D24D969E','f0004','CariRoma','07/10/2023',TRUE,NULL,'14-60');
INSERT INTO Clienti VALUES ('DNLCRS00A25I138V','f0005','Caritas','08/01/2023',TRUE,8000,'14-60');
INSERT INTO Clienti VALUES ('PDRLRN978DK37FB5','f0006','Celivo','04/02/2023',TRUE,7000,'14-60');
INSERT INTO Clienti VALUES ('FVRFRN99JE9CSL4V','f0007','Emmaus','08/20/2023',TRUE,8000,'14-60');
INSERT INTO Clienti VALUES ('FRRLRN02H40ZL3NF','f0012','Caritas','06/29/2023',TRUE,7000,'14-60');
INSERT INTO Clienti VALUES ('CSTAMD95AL20C6BN','f0013','San Marcellino','08/12/2023',TRUE,8000,'14-60');
INSERT INTO Clienti VALUES ('FBRFBR769FB3IX8F','f0008','Comunità di Sant Egidio','09/15/2023',TRUE,8000,'60+');
INSERT INTO Clienti VALUES ('SLLGCM00Y5C8LA7D','f0009','Caritas','06/15/2023',TRUE,7000,'14-60');
INSERT INTO Clienti VALUES ('FBBDRA00S8DBHDTF','f0010','Comunità di Sant Egidio','10/18/2023',TRUE,7000,'14-60');
INSERT INTO Clienti VALUES ('JDBCKA76NCJD84GO','f0011','Celivo','03/08/2023',TRUE,6500,'14-60');
INSERT INTO Clienti VALUES ('PRSCHR11P0A7CL3H','f0005','Caritas','08/01/2023',FALSE,NULL,'06-14');
INSERT INTO Clienti VALUES ('FRRMME10B56D969Q','f0016','Caritas','08/01/2023',FALSE,NULL,'06-14');
INSERT INTO Clienti VALUES ('FRRLNE00R42D969M','f0016','Caritas', '08/04/2023',TRUE,8500,'14-60');
INSERT INTO Clienti VALUES ('SRRNNA95C68D969V','f0016','Caritas', '08/31/2023',TRUE,8500,'14-60');
INSERT INTO Clienti VALUES ('FGGLNZ83T06D969Q','f0015','Comunità di Sant Egidio','06/30/2023',TRUE,3000,'14-60');
INSERT INTO Clienti VALUES ('RSSLSN80R09L219E','f0014','Emmaus','07/15/2023',TRUE,9000,'14-60');
INSERT INTO Clienti VALUES ('RSSDRD99M12D969S','f0014','Emmaus','07/15/2023',TRUE,9000,'14-60');
INSERT INTO Clienti VALUES ('RSSCRN19L65G273P','f0014','Emmaus','07/15/2023',FALSE,NULL,'0-6');

INSERT INTO Volontari VALUES ('SCSGNN80E10D969E','auto','lunedì venerdì',TRUE,TRUE,TRUE,'Emmaus');
INSERT INTO Volontari VALUES ('MRRFBB70A1I138V','furgone','venerdì sabato domenica',FALSE,FALSE,TRUE,'Aiutiamo');
INSERT INTO Volontari VALUES ('MGGNCL00B24D969E','furgone','lunedì martedì mercoledì giovedì venerdì sabato domenica',TRUE,TRUE,TRUE,'Caritas');
INSERT INTO Volontari VALUES ('PSQGLL99E54I138T','auto','lunedì venerdì domenica',FALSE,TRUE,TRUE,'Umanitas');
INSERT INTO Volontari VALUES ('BRDDMNA25B347TGT','camion','martedì mercoledì sabato',FALSE,TRUE,TRUE,'Caritas');
INSERT INTO Volontari VALUES ('CNTLBR98IC8F40G7','furgone','martedì mercoledì venerdì',TRUE,FALSE,TRUE,'Caritas');
INSERT INTO Volontari VALUES ('FBBMTT05LAIW4V20','auto','mercoledì giovedì sabato',FALSE,FALSE,TRUE,'Caritas');
INSERT INTO Volontari VALUES ('WNNCLB93LE49C7V0','furgone','giovedì venerdì sabato',TRUE,TRUE,TRUE,'Comunità di Sant Egidio');
INSERT INTO Volontari VALUES ('MRGSLV018D7GL37S','auto','venerdì sabato',TRUE,FALSE,FALSE,'Emmaus');
INSERT INTO Volontari VALUES ('GCBCRS92ISYFN3F8','auto','sabato domenica',FALSE,TRUE,FALSE,'Celivo');
INSERT INTO Volontari VALUES ('CNTSFA87IFDUVBS1','furgone','domenica lunedì',TRUE,FALSE,TRUE,'San Marcellino');
INSERT INTO Volontari VALUES ('RPTCHR01S56D969C','furgone','lunedì martedì giovedì domenica',TRUE,TRUE,TRUE,'Emmaus');
INSERT INTO Volontari VALUES ('FNTDRA84E22H501G','auto','domenica mercoledì',TRUE,FALSE,FALSE,'Marcus');
INSERT INTO Volontari VALUES ('MRLSRG65D14D969D','furgone','giovedì venerdì',TRUE,FALSE,TRUE,'Dorotea');
INSERT INTO Volontari VALUES ('CLMMGH98H59F839G','camion','sabato domenica',FALSE,TRUE,TRUE,'Emmaus');
INSERT INTO Volontari VALUES ('CSTBRC01H49F205L','camion','giovedì venerdì domenica',FALSE,TRUE,TRUE,'Dorotea');
INSERT INTO Volontari VALUES ('BNCTRS72D59D969K','auto','mercoledì giovedì venerdì ',TRUE,TRUE,FALSE,'Marcus');

INSERT INTO Appuntamenti VALUES('ap234560','09/10/2023 11:00:00','GRZCLL00D64I138Y','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES('ap234561','09/10/2023 11:30:00','MDSGLC96M10I138S','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES('ap234562','09/11/2023 09:00:00','DNLNTN68A41I138O','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES('ap234563','09/11/2023 09:30:00','GRBLGG60T12U123E','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES('ap234564','09/12/2023 10:00:00','PSCMRZ50B25I909F','SCSGNN80E10D969E');
INSERT INTO Appuntamenti VALUES ('ap123456','07/28/2023 09:00:00','CSTAMD95AL20C6BN','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap123457','09/02/2023 08:00:00','FRRLRN02H40ZL3NF','CNTLBR98IC8F40G7');
INSERT INTO Appuntamenti VALUES ('ap123458','08/13/2023 08:30:00','FVRFRN99JE9CSL4V','FBBMTT05LAIW4V20');
INSERT INTO Appuntamenti VALUES ('ap123459','03/20/2023 12:00:00','PDRLRN978DK37FB5','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap123463','07/25/2023','DNLCRS00A25I138V','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap233459','08/03/2023','FGGLNZ83T06D969Q', 'BNCTRS72D59D969K');
INSERT INTO Appuntamenti VALUES ('ap233458','08/03/2023','FRRLNE00R42D969M', 'BNCTRS72D59D969K');
INSERT INTO Appuntamenti VALUES ('ap233460','08/04/2023','RSSLSN80R09L219E','CSTBRC01H49F205L');
INSERT INTO Appuntamenti VALUES ('ap233464','08/04/2023','FGGLNZ83T06D969Q','CSTBRC01H49F205L');
INSERT INTO Appuntamenti VALUES ('ap233475','08/07/2023','RSSLSN80R09L219E','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap233465','08/04/2023','SRRNNA95C68D969V','CSTBRC01H49F205L');
INSERT INTO Appuntamenti VALUES ('ap233499','08/04/2023','FGGLNZ83T06D969Q','CSTBRC01H49F205L');
INSERT INTO Appuntamenti VALUES ('ap233466','08/07/2023','FRRLNE00R42D969M','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap233467','08/07/2023','RMNFRN78C29T789E','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap100000','01/08/2023 10:00:00','GRZCLL00D64I138Y','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap100001','02/05/2023 10:00:00','PSCMRZ50B25I909F','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap100002','11/12/2023 10:00:00','PSCMRZ50B25I909F','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap100003','04/05/2023 09:00:00','PSCMRZ50B25I909F','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap100004','05/03/2023 08:15:00','PSCMRZ50B25I909F','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap100005','06/02/2023 11:00:00','PSCMRZ50B25I909F','WNNCLB93LE49C7V0');
INSERT INTO Appuntamenti VALUES ('ap100006','07/02/2023 09:30:00','PSCMRZ50B25I909F','WNNCLB93LE49C7V0');
INSERT INTO Appuntamenti VALUES ('ap100007','08/02/2023 09:30:00','GRZCLL00D64I138Y','WNNCLB93LE49C7V0');
INSERT INTO Appuntamenti VALUES ('ap100011','05/02/2023 11:00:00','SLLGCM00Y5C8LA7D','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap100012','05/07/2023 11:15:00','FBBDRA00S8DBHDTF','CLMMGH98H59F839G');
INSERT INTO Appuntamenti VALUES ('ap100013','05/12/2023 11:30:00','JDBCKA76NCJD84GO','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap100008','08/03/2023 09:00:00','DNLCRS00A25I138V','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap100009','09/03/2023 09:00:00','FVRFRN99JE9CSL4V','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap100010','07/02/2023 09:00:00','FBRFBR769FB3IX8F','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000001','10/18/2023 11:30:00','PSCMRZ50B25I909F','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000002','10/20/2023 09:00:00','PSCMRZ50B25I909F','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES ('ap000003','10/03/2023 09:00:00','PSCMRZ50B25I909F','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap000004','10/05/2023 11:30:00','GRBLGG60T12U123E','SCSGNN80E10D969E');
INSERT INTO Appuntamenti VALUES ('ap000005','10/10/2023 09:00:00','GRBLGG60T12U123E','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap000006','08/27/2023 09:00:00','GRBLGG60T12U123E','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000007','07/07/2023 11:30:00','RMNFRN78C29T789E','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES ('ap000008','08/08/2023 09:00:00','RMNFRN78C29T789E','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap000009','01/09/2023 09:00:00','RMNFRN78C29T789E','SCSGNN80E10D969E');
INSERT INTO Appuntamenti VALUES ('ap000010','02/10/2023 11:30:00','DNLNTN68A41I138O','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap000011','03/11/2023 09:00:00','DNLNTN68A41I138O','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000012','04/12/2023 09:00:00','DNLNTN68A41I138O','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES ('ap000013','10/18/2023 11:30:00','DNLCRS00A25I138V','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap000014','11/14/2023 09:00:00','DNLCRS00A25I138V','SCSGNN80E10D969E');
INSERT INTO Appuntamenti VALUES ('ap000015','10/08/2023 09:00:00','DNLCRS00A25I138V','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap000016','08/16/2023 11:30:00','PDRLRN978DK37FB5','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000017','10/17/2023 09:00:00','PDRLRN978DK37FB5','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES ('ap000018','10/21/2023 09:00:00','PDRLRN978DK37FB5','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap000019','07/19/2023 11:30:00','FVRFRN99JE9CSL4V','SCSGNN80E10D969E');
INSERT INTO Appuntamenti VALUES ('ap000020','08/20/2023 09:00:00','FVRFRN99JE9CSL4V','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap000021','01/21/2023 09:00:00','FVRFRN99JE9CSL4V','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000022','02/22/2023 11:30:00','FRRLRN02H40ZL3NF','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES ('ap000023','03/23/2023 09:00:00','FRRLRN02H40ZL3NF','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap000024','04/24/2023 09:00:00','FRRLRN02H40ZL3NF','SCSGNN80E10D969E');
INSERT INTO Appuntamenti VALUES ('ap000025','10/25/2023 11:30:00','CSTAMD95AL20C6BN','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap000026','11/30/2023 09:00:00','CSTAMD95AL20C6BN','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000027','09/27/2023 09:00:00','CSTAMD95AL20C6BN','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES ('ap000028','11/28/2023 11:30:00','FBRFBR769FB3IX8F','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap000029','05/01/2023 09:00:00','FBRFBR769FB3IX8F','SCSGNN80E10D969E');
INSERT INTO Appuntamenti VALUES ('ap000030','06/02/2023 09:00:00','FBRFBR769FB3IX8F','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap000031','07/03/2023 11:30:00','SLLGCM00Y5C8LA7D','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000032','08/04/2023 09:00:00','SLLGCM00Y5C8LA7D','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES ('ap000033','01/05/2023 09:00:00','SLLGCM00Y5C8LA7D','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap000034','02/06/2023 11:30:00','FBBDRA00S8DBHDTF','SCSGNN80E10D969E');
INSERT INTO Appuntamenti VALUES ('ap000035','03/07/2023 09:00:00','FBBDRA00S8DBHDTF','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap000036','04/08/2023 09:00:00','FBBDRA00S8DBHDTF','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000037','05/09/2023 11:30:00','JDBCKA76NCJD84GO','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES ('ap000038','06/10/2023 09:00:00','JDBCKA76NCJD84GO','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap000039','07/11/2023 09:00:00','JDBCKA76NCJD84GO','SCSGNN80E10D969E');
INSERT INTO Appuntamenti VALUES ('ap000040','08/12/2023 11:30:00','SRRNNA95C68D969V','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap000041','10/18/2023 09:00:00','SRRNNA95C68D969V','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000042','06/14/2023 09:00:00','SRRNNA95C68D969V','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES ('ap000043','07/15/2023 11:30:00','FGGLNZ83T06D969Q','MGGNCL00B24D969E');
INSERT INTO Appuntamenti VALUES ('ap000044','08/16/2023 09:00:00','FGGLNZ83T06D969Q','SCSGNN80E10D969E');
INSERT INTO Appuntamenti VALUES ('ap000045','01/17/2023 09:00:00','FGGLNZ83T06D969Q','RPTCHR01S56D969C');
INSERT INTO Appuntamenti VALUES ('ap000046','02/18/2023 11:30:00','RSSLSN80R09L219E','BRDDMNA25B347TGT');
INSERT INTO Appuntamenti VALUES ('ap000047','03/19/2023 09:00:00','RSSLSN80R09L219E','PSQGLL99E54I138T');
INSERT INTO Appuntamenti VALUES ('ap000048','08/20/2023 09:00:00','RSSLSN80R09L219E','MGGNCL00B24D969E');

INSERT INTO Inventario VALUES ('TonnoAcqueblu','10/15/2023',12,2,'11/15/2023','tonno');
INSERT INTO Inventario VALUES ('TonnoAcqueblu','11/21/2024',19,2,'12/21/2024','tonno');
INSERT INTO Inventario VALUES ('SpazzolinoMentadent','10/18/2035',5,2,'10/18/2036','spazzolino',FALSE);
INSERT INTO Inventario VALUES ('PannoliniPampers','12/20/2033',5,3,'01/20/2033','pannolini',FALSE);
INSERT INTO Inventario VALUES ('SpinacinaAia','08/30/2023',5,2,'09/06/2023','spinacina');
INSERT INTO Inventario VALUES ('SpinacinaAia','08/25/2023',3,2,'09/01/2023','spinacina');
INSERT INTO Inventario VALUES ('RisoScotti','10/30/2023',4,2,'11/30/2023','riso');
INSERT INTO Inventario VALUES ('MaisBonduelle','10/15/2024',7,1,'10/08/2024','mais');
INSERT INTO Inventario VALUES ('RicottaVallelata','10/01/2023',6,1, '10/03/2023','ricotta');
INSERT INTO Inventario VALUES ('FusilliDececco','02/20/2024',16,1,'03/20/2024','pasta');
INSERT INTO Inventario VALUES ('RigatoniAgnesi','03/20/2024',6,1,'08/20/2024','pasta');
INSERT INTO Inventario VALUES ('AcquaLete','10/10/2023',15,1,'06/05/2023','acqua');
INSERT INTO Inventario VALUES ('MarmellataZuegg','09/11/2023',3,2,'10/11/2023','marmellata');
INSERT INTO Inventario VALUES ('DeodoranteLicia','10/18/2033',9,1,'10/18/2033','deodorante',FALSE);
INSERT INTO Inventario VALUES ('AcquaFerrarelle','08/08/2024',7,1,'09/08/2024','acqua');
INSERT INTO Inventario VALUES ('PaneAngeli','09/15/2023',6,2,'09/22/2023','pane');
INSERT INTO Inventario VALUES ('PaneAngeli','08/15/2023',5,2,'08/22/2023','pane');
INSERT INTO Inventario VALUES ('AcquaLete','09/22/2023',50,1,'10/05/2023','acqua');
INSERT INTO Inventario VALUES ('TonnoAsdomar','12/15/2025',20,2,'12/15/2026','tonno');
INSERT INTO Inventario VALUES ('PastaBarilla','11/03/2024',10,2,'05/03/2025','pasta');
INSERT INTO Inventario VALUES ('LatteGranarolo','12/01/2023',14,3,'12/02/2023','latte');
INSERT INTO Inventario VALUES ('SalsaMutti','07/30/2024',5,3,'08/30/2024','salsa');
INSERT INTO Inventario VALUES ('AcquaLete','02/05/2023',13,1,'10/10/2023','acqua');
INSERT INTO Inventario VALUES ('GoccioleCoop','11/15/2023',9,3,'10/15/2023','biscotti');
INSERT INTO Inventario VALUES ('SaponePulitello','10/18/2033',4,3,'10/18/2033','sapone',FALSE);
INSERT INTO Inventario VALUES ('FagioliFagioletto','09/09/2028',10,4,'09/09/2029','legumi');
INSERT INTO Inventario VALUES ('TonnoAsdomar','08/25/2027',20,2,'08/25/2028','tonno');
INSERT INTO Inventario VALUES ('TonnoRioMare','10/01/2024',82,2,'10/06/2024','tonno');
INSERT INTO Inventario VALUES ('OlioDante','12/15/2023',5,2,'10/15/2023','olio');
INSERT INTO Inventario VALUES ('SalsaAgromonte','09/01/2024',4,1,'12/01/2024','pelati');
INSERT INTO Inventario VALUES ('WurstelPollo','01/31/2024',5,1,'04/30/2024','wurstel');
INSERT INTO Inventario VALUES ('MozzarellaSaporita','10/30/2023',8,2,'11/15/2023','mozzarella');
INSERT INTO Inventario VALUES ('FagioliniIt','10/15/2023',6,1,'11/15/2024','fagioli');
INSERT INTO Inventario VALUES ('MozzarellaSaporita','10/21/2023',3,2, '11/03/2023','mozzarella');
INSERT INTO Inventario VALUES ('SalsaAgromonte','10/15/2023',9,1,'10/15/2024','pelati');
INSERT INTO Inventario VALUES ('LenticchiIt','06/20/2024',3,1,'12/20/2024','lenticchie');
INSERT INTO Inventario VALUES ('PastaFarfalle','10/18/2023',9,1,'08/01/2023','pasta');
INSERT INTO Inventario VALUES ('PastaMaccheroni','04/10/2023',5,1,'02/10/2023','pasta');
INSERT INTO Inventario VALUES ('AcquaBenedettoN','11/25/2023',13,1,'11/25/2025','acqua');
INSERT INTO Inventario VALUES ('ShampoPantene','12/20/2021',4,2,'09/10/2023','shampoo');
INSERT INTO Inventario VALUES ('AcquaFerrarelle','07/08/2023',5,1,'08/08/2023','acqua');
INSERT INTO Inventario VALUES ('FusilliDececco','08/20/2023',7,1,'05/20/2023','pasta');
INSERT INTO Inventario VALUES ('OlioDante','10/10/2023',6,2,'06/05/2023','olio');
INSERT INTO Inventario VALUES ('MozzarellaSaporita','11/12/2023',3,2,'03/16/2023','mozzarella');
INSERT INTO Inventario VALUES ('TonnoAsdomar','10/18/2023',3,1,'02/01/2023','tonno');
INSERT INTO Inventario VALUES ('GoccioleCoop','10/20/2023',3,2,'02/03/2023','biscotti');
INSERT INTO Inventario VALUES ('OlioDante','10/03/2023',6,1,'04/01/2023','olio');
INSERT INTO Inventario VALUES ('WurstelPollo','10/05/2023',5,1,'05/03/2023','wurstel');
INSERT INTO Inventario VALUES ('MozzarellaSaporita','10/10/2023',5,2,'06/04/2023','mozzarella');
INSERT INTO Inventario VALUES ('SalsaAgromonte','08/27/2023',7,2,'07/05/2023','salsa');
INSERT INTO Inventario VALUES ('AcquaBenedettoN','07/07/2023',1,1,'08/06/2023','acqua');
INSERT INTO Inventario VALUES ('OlioDante','08/08/2023',4,2,'09/07/2023','olio');
INSERT INTO Inventario VALUES ('TonnoAcqueBlu','09/09/2023',7,2,'10/08/2023','tonno');
INSERT INTO Inventario VALUES ('TonnoAcqueBlu','10/10/2023',11,3,'11/09/2023','tonno');
INSERT INTO Inventario VALUES ('AcquaFerrarelle','11/11/2023',3,3,'12/10/2023','acqua');
INSERT INTO Inventario VALUES ('FusilliDececco','12/12/2023',4,1,'01/11/2023','pasta');
INSERT INTO Inventario VALUES ('OlioDante','10/18/2023',4,3,'02/12/2023','olio');
INSERT INTO Inventario VALUES ('MozzarellaSaporita','11/14/2023',5,3,'03/13/2023','mozzarella');
INSERT INTO Inventario VALUES ('OlioDante','10/08/2023',2,4,'04/14/2023','olio');
INSERT INTO Inventario VALUES ('SalsaAgromonte','08/16/2023',6,2,'05/15/2023','salsa');
INSERT INTO Inventario VALUES ('TonnoAsdomar','10/17/2023',3,2,'06/16/2023','tonno');
INSERT INTO Inventario VALUES ('GoccioleCoop','10/21/2023',6,2,'07/17/2023','biscotti');
INSERT INTO Inventario VALUES ('WurstelPollo','07/19/2023',6,1,'08/18/2023','wurstel');
INSERT INTO Inventario VALUES ('SalsaAgromonte','08/20/2023',5,1,'09/19/2023','salsa');
INSERT INTO Inventario VALUES ('TegoliniFerrero','09/21/2023',1,2,'10/20/2023','merendine');
INSERT INTO Inventario VALUES ('BucatiniDececco','10/22/2023',1,1,'11/21/2023','pasta');
INSERT INTO Inventario VALUES ('TonnoNostromo','11/23/2023',1,2, '12/23/2023','tonno');
INSERT INTO Inventario VALUES ('PelatiSollazzi','12/24/2023',1,1,'01/24/2023','pelati');
INSERT INTO Inventario VALUES ('AcquaPanna','10/25/2023',6,1,'02/25/2023','acqua');
INSERT INTO Inventario VALUES ('MerendineBuonine','11/30/2023',3,1,'03/26/2023','merendine');
INSERT INTO Inventario VALUES ('FocaccineEsselunga','09/27/2023',4,1,'04/27/2023','pane');
INSERT INTO Inventario VALUES ('BaiocchiMulinoBianco','11/28/2023',3,1,'05/28/2023','biscotti');
INSERT INTO Inventario VALUES ('TonnoRioMare','08/22/2024',35,1,'08/22/2025','tonno');
INSERT INTO Inventario VALUES ('SalsaAgromonte','11/06/2024',5,1,'11/06/2025','pelati');
INSERT INTO Inventario VALUES ('PaneAngeli','09/16/2023',3,1,'09/16/2023','pane');
INSERT INTO Inventario VALUES ('WurstelPollo','02/28/2024',8,1,'03/28/2024','wurstel');
INSERT INTO Inventario VALUES ('MozzarellaSaporita','11/30/2023',3,1,'11/30/2023','mozzarella');
INSERT INTO Inventario VALUES ('FagioliniIt','11/15/2023',4,1,'12/15/2023','mozzarella');
INSERT INTO Inventario VALUES ('MozzarellaSaporita','10/29/2023',5,1,'11/29/2023','mozzarella');
INSERT INTO Inventario VALUES ('SalsaAgromonte','11/25/2024',6,1,'11/25/2023','mozzarella');

INSERT INTO Enti VALUES ('con12312312345645678','Conad','Ipermercato','via del Piano 456',01083937356);
INSERT INTO Enti VALUES ('bsk12234567890121212','Basko','Supermercato','Corso Europa 2',01083937354);
INSERT INTO Enti VALUES ('euro1212121245678789','Eurospin','Supermercato','via Giustizia 1',01083937352);
INSERT INTO Enti VALUES ('ent34567','EntePalmaro','Associazione','via Paolo Parodi 02',01083937358);

INSERT INTO Donazioni VALUES ('don23450','PSQGLL99E54I138T',NULL,NULL,'8-14-2023 12:00:00');
INSERT INTO Donazioni VALUES ('don23451','PSQGLL99E54I138T',NULL,50,'8-13-2023 12:00:00');
INSERT INTO Donazioni VALUES ('don23452','BRDDMNA25B347TGT',NULL,NULL,'8-14-2023 08:00:00');
INSERT INTO Donazioni VALUES ('don23453','BRDDMNA25B347TGT',NULL,NULL,'8-14-2023 11:00:00');
INSERT INTO Donazioni VALUES ('don23454','BRDDMNA25B347TGT',NULL,500,'8-17-2023 10:00:00');
INSERT INTO Donazioni VALUES ('don23456',NULL, 'con12312312345645678',NULL,'8-06-2023 10:00:00');
INSERT INTO Donazioni VALUES ('don23457','LGBVTT67E13I567D',NULL,100,'8-17-2023 10:50:00');
INSERT INTO Donazioni VALUES ('don23458','FRNMRA80A01I480M',NULL,NULL,'8-11-2023 11:00:00');
INSERT INTO Donazioni VALUES ('don23459','FRNMRA80A01I480M',NULL,NULL,'8-12-2023 08:30:30');
INSERT INTO Donazioni VALUES ('don23460','FRNMRA80A01I480M',NULL,1000,'8-12-2023 10:20:30');
INSERT INTO Donazioni VALUES ('don23461','LNFGRG51L07A089L',NULL,NULL,'8-12-2023 10:40:00');
INSERT INTO Donazioni VALUES ('don23462',NULL,'bsk12234567890121212',NULL,'8-13-2023 11:10:00');
INSERT INTO Donazioni VALUES ('don23463','MGGNCL00B24D969E',NULL,NULL,'8-13-2023 11:45:00');
INSERT INTO Donazioni VALUES ('don23464','MGGNCL00B24D969E',NULL,60,'8-14-2023 09:00:00');
INSERT INTO Donazioni VALUES ('don12345',NULL,'euro1212121245678789',NULL,'8-14-2023 09:15:30');
INSERT INTO Donazioni VALUES ('don12346','JDBCKA76NCJD84GO',NULL,1000,'8-14-2023 09:30:30');
INSERT INTO Donazioni VALUES ('don12347','GCBCRS92ISYFN3F8',NULL,40,'8-14-2023 09:45:30');
INSERT INTO Donazioni VALUES ('don12400','MRLSRG65D14D969D',NULL,NULL,'8-10-2023 09:00:30');
INSERT INTO Donazioni VALUES ('don12401','RPTCHR01S56D969C',NULL,1500,'8-10-2023 09:20:30');
INSERT INTO Donazioni VALUES ('don12402','MRLSRG65D14D969D',NULL,NULL,'8-10-2023 10:00:30');
INSERT INTO Donazioni VALUES ('don12403','FNTDRA84E22H501G',NULL,500,'8-10-2023 10:15:30');
INSERT INTO Donazioni VALUES ('don12404','FNTDRA84E22H501G',NULL,NULL,'8-10-2023 10:40:30');
INSERT INTO Donazioni VALUES ('don12406','RPTCHR01S56D969C',NULL,NULL,'8-10-2023 10:55:30');
INSERT INTO Donazioni VALUES ('don12407','BNCTRS72D59D969K',NULL,NULL,'8-10-2023 11:05:30');
INSERT INTO Donazioni VALUES ('don12408','BNCTRS72D59D969K',NULL,1200,'8-10-2023 11:25:30');
INSERT INTO Donazioni VALUES ('don12409',NULL,'ent34567',NULL,'8-11-2023 09:15:30');
INSERT INTO Donazioni VALUES ('don12410','FNTDRA84E22H501G',NULL,NULL,'8-11-2023 09:35:30');
INSERT INTO Donazioni VALUES ('don12411','MRLSRG65D14D969D',NULL,NULL,'8-11-2023 09:55:30');
INSERT INTO Donazioni VALUES ('don12412','BNCTRS72D59D969K',NULL,NULL,'8-11-2023 10:15:30');

INSERT INTO ProdottiEntrata VALUES ('SaponePulitello','10/18/2033','01-19-2023 10:10:30','MGGNCL00B24D969E','MGGNCL00B24D969E','sapone',NULL);
INSERT INTO ProdottiEntrata VALUES ('SalsaAgromonte','10/15/2023','01-19-2023 10:10:30','MGGNCL00B24D969E','MGGNCL00B24D969E','pelati',NULL);
INSERT INTO ProdottiEntrata VALUES ('MozzarellaSaporita','11/12/2023','02/01/2023','MGGNCL00B24D969E','MGGNCL00B24D969E','mozzarella');
INSERT INTO ProdottiEntrata VALUES ('OlioDante','10/10/2023','10/20/2023','MGGNCL00B24D969E','MGGNCL00B24D969E','olio');
INSERT INTO ProdottiEntrata VALUES ('TonnoAcqueblu','10/15/2023','10/18/2023','MGGNCL00B24D969E','MGGNCL00B24D969E','tonno');
INSERT INTO ProdottiEntrata VALUES ('TonnoAcqueblu','11/21/2024','10/18/2023','MGGNCL00B24D969E','MGGNCL00B24D969E','tonno');
INSERT INTO ProdottiEntrata VALUES ('FusilliDececco','08/20/2023','01/05/2023','MGGNCL00B24D969E','MGGNCL00B24D969E','pasta',NULL);
INSERT INTO ProdottiEntrata VALUES ('AcquaFerrarelle','07/08/2023','03-10-2023','WNNCLB93LE49C7V0','WNNCLB93LE49C7V0','acqua',NULL);
INSERT INTO ProdottiEntrata VALUES ('SpinacinaAia','08/30/2023','8-15-2023 12:00:00','PSQGLL99E54I138T','MGGNCL00B24D969E','spinacina','don23450');
INSERT INTO ProdottiEntrata VALUES ('SpazzolinoMentadent','10/18/2035','8-14-2023 09:00:00','SCSGNN80E10D969E','MGGNCL00B24D969E','spazzolino','don23452');
INSERT INTO ProdottiEntrata VALUES ('AcquaFerrarelle','08/08/2024','8-25-2023 11:00:00','WNNCLB93LE49C7V0','MGGNCL00B24D969E','acqua','don23453');
INSERT INTO ProdottiEntrata VALUES ('DeodoranteLicia','10/18/2033','8-10-2023 10:00:00','MGGNCL00B24D969E','MGGNCL00B24D969E','deodorante','don23456');
INSERT INTO ProdottiEntrata VALUES ('MaisBonduelle','10/15/2024','8-12-2023 14:00:00','SCSGNN80E10D969E','SCSGNN80E10D969E','mais','don23458');
INSERT INTO ProdottiEntrata VALUES ('RigatoniAgnesi','03/20/2024','8-20-2023 15:20:30','CLMMGH98H59F839G','MGGNCL00B24D969E','pasta','don23459');
INSERT INTO ProdottiEntrata VALUES ('FusilliDececco','02/20/2024','8-13-2023 09:00:00','CLMMGH98H59F839G','MGGNCL00B24D969E','pasta','don23461');
INSERT INTO ProdottiEntrata VALUES ('RisoScotti','10/30/2023','8-29-2023 09:00:00','SCSGNN80E10D969E','SCSGNN80E10D969E','riso','don23462');/*qui*/
INSERT INTO ProdottiEntrata VALUES ('SpinacinaAia','08/25/2023','8-28-2023 11:45:00','SCSGNN80E10D969E','MGGNCL00B24D969E','spinacina','don23463');
INSERT INTO ProdottiEntrata VALUES ('PaneAngeli','9/15/2023','8-14-2023 12:10:30','CLMMGH98H59F839G','RPTCHR01S56D969C','pane','don12345');
INSERT INTO ProdottiEntrata VALUES ('TonnoRioMare','10/01/2024','01-14-2023 10:00:30','MGGNCL00B24D969E','MGGNCL00B24D969E','tonno','don12400');
INSERT INTO ProdottiEntrata VALUES ('OlioDante','12/15/2023','8-19-2023 12:10:30','CLMMGH98H59F839G','FNTDRA84E22H501G','olio','don12402');
INSERT INTO ProdottiEntrata VALUES ('SalsaAgromonte','09/01/2024','8-19-2023 10:10:30','CSTBRC01H49F205L','BNCTRS72D59D969K','pelati','don12404');
INSERT INTO ProdottiEntrata VALUES ('PaneAngeli','08/15/2023','8-19-2023 11:00:30','CSTBRC01H49F205L','BNCTRS72D59D969K','pane','don12412');
INSERT INTO ProdottiEntrata VALUES ('WurstelPollo','01/31/2024','8-21-2023 10:00:30','CSTBRC01H49F205L','RPTCHR01S56D969C','wurstel','don12406');
INSERT INTO ProdottiEntrata VALUES ('MozzarellaSaporita','10/30/2023','8-21-2023 09:00:30','CLMMGH98H59F839G','FNTDRA84E22H501G','mozzarella','don12407');
INSERT INTO ProdottiEntrata VALUES ('FagioliniIt','10/15/2023','8-26-2023 09:30:30','CSTBRC01H49F205L','BNCTRS72D59D969K','fagioli','don12409');
INSERT INTO ProdottiEntrata VALUES ('MozzarellaSaporita','10/21/2023','8-28-2023 11:45:30','CLMMGH98H59F839G','FNTDRA84E22H501G','mozzarella','don12410');
INSERT INTO ProdottiEntrata VALUES ('SalsaAgromonte','10/15/2023','8-26-2023 10:30:30','CSTBRC01H49F205L','BNCTRS72D59D969K','pelati','don12411');/*finoqui*/
INSERT INTO ProdottiEntrata VALUES ('LenticchiIt','06/20/2024','8-28-2023 11:15:30','CLMMGH98H59F839G','RPTCHR01S56D969C','lenticchie','don12412');
INSERT INTO ProdottiEntrata VALUES ('FagioliniIt','10/15/2023','08-08-2023','MGGNCL00B24D969E','MGGNCL00B24D969E','fagioli',NULL);
INSERT INTO ProdottiEntrata VALUES ('MaisBonduelle','10/15/2024','09-08-2023','MGGNCL00B24D969E','MGGNCL00B24D969E','mais',NULL);
INSERT INTO ProdottiEntrata VALUES ('TonnoAsdomar','12/15/2025','01/02/2023','MGGNCL00B24D969E','MGGNCL00B24D969E','tonno',NULL);
INSERT INTO ProdottiEntrata VALUES ('GoccioleCoop','11/15/2023','01/03/2023','MGGNCL00B24D969E','MGGNCL00B24D969E','biscotti',NULL);
INSERT INTO ProdottiEntrata VALUES ('AcquaBenedettoN','11/25/2023','10/08/2023','MGGNCL00B24D969E','MGGNCL00B24D969E','acqua',NULL);
INSERT INTO ProdottiEntrata VALUES ('TonnoAsdomar','12/15/2025','01/06/2023','MGGNCL00B24D969E','MGGNCL00B24D969E','tonno',NULL);
INSERT INTO ProdottiEntrata VALUES ('TonnoRioMare','8/22/2024','7-22-2023 10:00:30','CLMMGH98H59F839G','FNTDRA84E22H501G','tonno',NULL);
INSERT INTO ProdottiEntrata VALUES ('OlioDante','12/15/2023','8-19-2023 12:30:30','CLMMGH98H59F839G','FNTDRA84E22H501G','olio',NULL);
INSERT INTO ProdottiEntrata VALUES ('SalsaAgromonte','11/06/2024','8-19-2023 13:10:30','CSTBRC01H49F205L','BNCTRS72D59D969K','pelati',NULL);
INSERT INTO ProdottiEntrata VALUES ('PaneAngeli','09/16/2023','8-19-2023 12:00:30','CSTBRC01H49F205L','BNCTRS72D59D969K','pane',NULL);
INSERT INTO ProdottiEntrata VALUES ('WurstelPollo','02/28/2024','8-22-2023 10:00:30','CSTBRC01H49F205L','RPTCHR01S56D969C','wurstel',NULL);
INSERT INTO ProdottiEntrata VALUES ('MozzarellaSaporita','11/30/2023','8-23-2023 09:00:30','CLMMGH98H59F839G','FNTDRA84E22H501G','mozzarella',NULL);
INSERT INTO ProdottiEntrata VALUES ('FagioliniIt','11/15/2023','8-30-2023 09:30:30','CSTBRC01H49F205L','BNCTRS72D59D969K','fagioli',NULL);
INSERT INTO ProdottiEntrata VALUES ('MozzarellaSaporita','10/29/2023','8-24-2023 11:45:30','CLMMGH98H59F839G','FNTDRA84E22H501G','mozzarella',NULL);
INSERT INTO ProdottiEntrata VALUES ('SalsaAgromonte','11/25/2024','8-06-2023 10:30:30','CSTBRC01H49F205L','BNCTRS72D59D969K','pelati',NULL);

INSERT INTO ProdottiUscita VALUES ('ap234560','TonnoAcqueblu','10/15/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap234561','SpinacinaAia','08/30/2023',2);
INSERT INTO ProdottiUscita VALUES ('ap234561','RisoScotti','10/30/2023',3);
INSERT INTO ProdottiUscita VALUES ('ap234562','AcquaFerrarelle','08/08/2024',5);
INSERT INTO ProdottiUscita VALUES ('ap234563','FusilliDececco','02/20/2024',2);
INSERT INTO ProdottiUscita VALUES ('ap234564','FusilliDececco','02/20/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap123456','PaneAngeli','09/15/2023',2);
INSERT INTO ProdottiUscita VALUES ('ap123457','SaponePulitello','10/18/2033',1);
INSERT INTO ProdottiUscita VALUES ('ap123458','TonnoAsdomar','12/15/2025',3);
INSERT INTO ProdottiUscita VALUES ('ap123459','GoccioleCoop','11/15/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap233459','OlioDante','12/15/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap233458','WurstelPollo','01/31/2024',3);
INSERT INTO ProdottiUscita VALUES ('ap233460','MozzarellaSaporita','10/30/2023',4);
INSERT INTO ProdottiUscita VALUES ('ap233464','SalsaAgromonte','10/15/2023',7);
INSERT INTO ProdottiUscita VALUES ('ap233475','AcquaBenedettoN','11/25/2023',11);
INSERT INTO ProdottiUscita VALUES ('ap233467','OlioDante','12/15/2023',3);
INSERT INTO ProdottiUscita VALUES ('ap233467','TonnoAcqueblu','10/15/2023',3);
INSERT INTO ProdottiUscita VALUES ('ap100001','TonnoAcqueblu','10/15/2023',3);
INSERT INTO ProdottiUscita VALUES ('ap100000','AcquaFerrarelle','07/08/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap100002','FusilliDececco','08/20/2023',4);
INSERT INTO ProdottiUscita VALUES ('ap100003','OlioDante','10/10/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap100001','MozzarellaSaporita','11/12/2023',2);
INSERT INTO ProdottiUscita VALUES ('ap100002','OlioDante','10/10/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap100003','SalsaAgromonte','10/15/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap100004','TonnoAsdomar','12/15/2025',2);
INSERT INTO ProdottiUscita VALUES ('ap100001','GoccioleCoop','11/15/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap100006','WurstelPollo','01/31/2024',2);
INSERT INTO ProdottiUscita VALUES ('ap100007','SalsaAgromonte','10/15/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap100011','TonnoRioMare','10/01/2024',3);
INSERT INTO ProdottiUscita VALUES ('ap100012','TonnoRioMare','10/01/2024',2);
INSERT INTO ProdottiUscita VALUES ('ap100013','TonnoRioMare','10/01/2024',4);
INSERT INTO ProdottiUscita VALUES ('ap100008','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap100009','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap100010','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap234560','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap234561','TonnoRioMare','10/01/2024',2);
INSERT INTO ProdottiUscita VALUES ('ap234562','TonnoRioMare','10/01/2024',5);
INSERT INTO ProdottiUscita VALUES ('ap234563','TonnoRioMare','10/01/2024',2);
INSERT INTO ProdottiUscita VALUES ('ap234564','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap123456','TonnoRioMare','10/01/2024',2);
INSERT INTO ProdottiUscita VALUES ('ap123457','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap123458','TonnoRioMare','10/01/2024',3);
INSERT INTO ProdottiUscita VALUES ('ap123459','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap233459','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap233458','TonnoRioMare','10/01/2024',3);
INSERT INTO ProdottiUscita VALUES ('ap233460','TonnoRioMare','10/01/2024',4);
INSERT INTO ProdottiUscita VALUES ('ap233464','TonnoRioMare','10/01/2024',7);
INSERT INTO ProdottiUscita VALUES ('ap233475','TonnoRioMare','10/01/2024',11);
INSERT INTO ProdottiUscita VALUES ('ap100000','TonnoRioMare','10/01/2024',2);
INSERT INTO ProdottiUscita VALUES ('ap100002','TonnoRioMare','10/01/2024',4);
INSERT INTO ProdottiUscita VALUES ('ap100003','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap100001','TonnoRioMare','10/01/2024',2);
INSERT INTO ProdottiUscita VALUES ('ap100004','TonnoRioMare','10/01/2024',2);
INSERT INTO ProdottiUscita VALUES ('ap100005','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap100006','TonnoRioMare','10/01/2024',2);
INSERT INTO ProdottiUscita VALUES ('ap100007','TonnoRioMare','10/01/2024',1);
INSERT INTO ProdottiUscita VALUES('ap000001','TonnoAcqueblu','10/15/2023',1);
INSERT INTO ProdottiUscita VALUES('ap000002','TonnoAcqueblu','11/21/2024',1);
INSERT INTO ProdottiUscita VALUES('ap000003','SpazzolinoMentadent','10/18/2035',1);
INSERT INTO ProdottiUscita VALUES ('ap000004','PannoliniPampers','12/20/2033',1);
INSERT INTO ProdottiUscita VALUES ('ap000005','SpinacinaAia','08/30/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000006','SpinacinaAia','08/25/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000007','RisoScotti','10/30/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000008','MaisBonduelle','10/15/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap000009','RicottaVallelata','10/01/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000010','FusilliDececco','02/20/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap000011','AcquaFerrarelle','11/11/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000012','FusilliDececco','12/12/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000013','RigatoniAgnesi','03/20/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap000014','AcquaLete','10/10/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000015','MarmellataZuegg','09/11/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000016','DeodoranteLicia','10/18/2033',1);
INSERT INTO ProdottiUscita VALUES ('ap000017','AcquaFerrarelle','08/08/2024',1);
INSERT INTO ProdottiUscita VALUES ('ap000018','PaneAngeli','09/15/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000019','PaneAngeli','08/15/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000020','AcquaLete','09/22/2023',1);
INSERT INTO ProdottiUscita VALUES('ap000021','TonnoAsdomar','10/18/2023',3);
INSERT INTO ProdottiUscita VALUES('ap000022','GoccioleCoop','10/20/2023',2);
INSERT INTO ProdottiUscita VALUES('ap000023','OlioDante','10/03/2023',4);
INSERT INTO ProdottiUscita VALUES ('ap000024','WurstelPollo','10/05/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000025','MozzarellaSaporita','10/10/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000026','SalsaAgromonte','08/27/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000027','AcquaBenedettoN','07/07/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000028','OlioDante','08/08/2023',2);
INSERT INTO ProdottiUscita VALUES ('ap000029','TonnoAcqueBlu','09/09/2023',5);
INSERT INTO ProdottiUscita VALUES ('ap000030','TonnoAcqueBlu','10/10/2023',2);
INSERT INTO ProdottiUscita VALUES ('ap000031','AcquaFerrarelle','11/11/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000032','FusilliDececco','12/12/2023',2);
INSERT INTO ProdottiUscita VALUES ('ap000033','OlioDante','10/18/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000034','MozzarellaSaporita','11/14/2023',3);
INSERT INTO ProdottiUscita VALUES ('ap000035','OlioDante','10/08/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000036','SalsaAgromonte','08/16/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000037','TonnoAsdomar','10/17/2023',3);
INSERT INTO ProdottiUscita VALUES ('ap000038','GoccioleCoop','10/21/2023',4);
INSERT INTO ProdottiUscita VALUES ('ap000039','WurstelPollo','07/19/2023',4);
INSERT INTO ProdottiUscita VALUES ('ap000040','SalsaAgromonte','08/20/2023',3);
INSERT INTO ProdottiUscita VALUES ('ap000041','TegoliniFerrero','09/21/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000042','BucatiniDececco','10/22/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000043','TonnoNostromo','11/23/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000044','PelatiSollazzi','12/24/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000045','AcquaPanna','10/25/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000046','MerendineBuonine','11/30/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000047','FocaccineEsselunga','09/27/2023',1);
INSERT INTO ProdottiUscita VALUES ('ap000048','BaiocchiMulinoBianco','11/28/2023',1);


INSERT INTO Trasporti VALUES ('via10000','MGGNCL00B24D969E',1,'Conad','09/01/2023 09:00:0');
INSERT INTO Trasporti VALUES ('via10001','MGGNCL00B24D969E',5,'Conad','08/31/2023 08:15:00');
INSERT INTO Trasporti VALUES ('via10002','SCSGNN80E10D969E',7,'Basko','08/30/2023 08:30:00');
INSERT INTO Trasporti VALUES ('via10003','MGGNCL00B24D969E',7,'Eurospin','08/25/2023 17:00:00');
INSERT INTO Trasporti VALUES ('via10004','MGGNCL00B24D969E',3,'Eurospin','08/28/2023 18:00:00');
INSERT INTO Trasporti VALUES ('via12345','RPTCHR01S56D969C',2,'Carrefour','03/22/2008 09:00:00');
INSERT INTO Trasporti VALUES ('via12346','CNTLBR98IC8F40G7',1,'Coop','11/13/2012 12:00:00');
INSERT INTO Trasporti VALUES ('via12347','WNNCLB93LE49C7V0',2,'Lidl','07/25/2014 19:00:00');
INSERT INTO Trasporti VALUES ('via12348','CNTSFA87IFDUVBS1',3,'Coop','05/12/2016 18:30:00');
INSERT INTO Trasporti VALUES ('via12360','MRLSRG65D14D969D',3,'Pam','08/18/2023 08:15:15');
INSERT INTO Trasporti VALUES ('via12361','MRLSRG65D14D969D',2,'Coop','08/21/2023 08:30:00');
INSERT INTO Trasporti VALUES ('via12362','BNCTRS72D59D969K',1,'Coop','08/18/2023 08:20:20');
INSERT INTO Trasporti VALUES ('via12363','BNCTRS72D59D969K',2,'Pam','08/21/2023 08:25:50');



/********************************************************************************************/
/*VISTE*/
--famiglie che hanno effettuato acquisti nell'ultimo mese, con saldo e punti spesi
CREATE OR REPLACE VIEW infofamiglia04 AS
SELECT famiglia, sum(Punti_spesi) AS Pnt_spesi_mese, pti_mensili , pti_mensili-sum(Punti_spesi) AS saldo_att
FROM (SELECT  Clienti.Cod_Fam AS famiglia , (Inventario.Num_Punti)*(ProdottiUscita.Quantità) AS Punti_spesi, Nuclei_Familiari.punti_mensili AS pti_mensili
	  FROM Clienti
	  JOIN Nuclei_Familiari ON Nuclei_Familiari.Cod_Fam=Clienti.Cod_Fam
	  LEFT OUTER JOIN Appuntamenti ON Appuntamenti.Id_Cl=Clienti.Cod_Fisc
	  JOIN ProdottiUscita ON ProdottiUscita.Cod_App=Appuntamenti.Cod_App
	  JOIN Inventario ON Inventario.Cod_Prod=ProdottiUscita.Cod_Prod AND Inventario.Data_Scad=ProdottiUscita.Data_Scad
	  WHERE extract(
    		month FROM Appuntamenti.Data_ora )= extract(
    		month FROM current_timestamp) AND extract(
    		year FROM Appuntamenti.Data_ora )= extract(
    		year FROM current_timestamp)
	  ) AS ragg_punti
GROUP BY famiglia, pti_mensili;

--famiglie che non hanno effettuato acquisti
CREATE OR REPLACE VIEW infofamiglia02 AS
SELECT famiglia
FROM(SELECT cod_fam AS famiglia
FROM nuclei_familiari
EXCEPT SELECT famiglia FROM infofamiglia04)
AS famiglie_no_acq;

--tutte le famiglie e i loro rispettivi saldi del mese
CREATE OR REPLACE VIEW infofamiglia01 AS
SELECT * FROM
infofamiglia04
UNION
SELECT distinct famiglia,pti_mensili-pti_mensili AS pnt_spesi_mese,pti_mensili,saldo
FROM(SELECT nuclei_familiari.cod_fam AS famiglia,punti_mensili AS pti_mensili,punti_mensili AS saldo
FROM infofamiglia02 JOIN nuclei_familiari ON infofamiglia02.famiglia=nuclei_familiari.cod_fam
JOIN clienti ON infofamiglia02.famiglia=clienti.cod_fam)
AS conteggi;


/*il numero di persone autorizzate per l’accesso al market, il numero di componenti totali e quelli appartenenti alla fascia d’età più bassa,*/
--abilitati al market
CREATE OR REPLACE VIEW infofamiglia05 AS
SELECT Clienti.Cod_Fam AS famiglia,  count(Clienti.Cod_Fisc) AS Abilitati
FROM Clienti
WHERE Clienti.Abilitato
GROUP BY famiglia;

--numero componenti
CREATE OR REPLACE VIEW infofamiglia06 AS
SELECT Clienti.Cod_Fam AS famiglia, count(Clienti.Cod_Fisc) AS Componenti
FROM Clienti
GROUP BY famiglia;

--minimo fascia di età
CREATE OR REPLACE VIEW infofamiglia07 AS
SELECT Clienti.Cod_Fam AS famiglia, min(Clienti.fasce) AS minimo_fascia
FROM Clienti
GROUP BY famiglia;

--componenti del minimo di fascia d'età
CREATE OR REPLACE VIEW infofamiglia08 AS
SELECT infofamiglia07.famiglia AS famiglia, count(Clienti.fasce) AS componenti_min_fascia, infofamiglia07.minimo_fascia
FROM infofamiglia07
JOIN Clienti ON infofamiglia07.famiglia=Clienti.Cod_Fam AND infofamiglia07.minimo_fascia=Clienti.fasce
GROUP BY famiglia,infofamiglia07.minimo_fascia;


/*il numero di spese effettuate nell’ultimo anno*/
CREATE OR REPLACE VIEW infofamiglia09 AS
SELECT famiglia, count(appu) AS spese
FROM (SELECT  Clienti.Cod_Fam AS famiglia, Appuntamenti.Cod_App AS appu
	  FROM Clienti
	  JOIN Nuclei_Familiari ON Nuclei_Familiari.Cod_Fam=Clienti.Cod_Fam
	  JOIN Appuntamenti ON Appuntamenti.Id_Cl=Clienti.Cod_Fisc
	  WHERE extract(
    		year FROM Appuntamenti.Data_ora )= extract(
    		year FROM current_timestamp)
	  ) AS ragg_punti
GROUP BY famiglia;


--i punti eventualmente non utilizzati nell’ultimo anno,
CREATE OR REPLACE VIEW infofamiglia10 AS
SELECT famiglia, sum(Punti_spesi) AS punti_annui_spesi, pti_mensili*(extract(month FROM current_timestamp)) AS punti_annui_totali, pti_mensili*(extract(month FROM current_timestamp))-sum(Punti_spesi) AS punti_annui_inutlizzati
FROM (SELECT  Clienti.Cod_Fam AS famiglia , (Inventario.Num_Punti)*(ProdottiUscita.Quantità) AS Punti_spesi, Nuclei_Familiari.punti_mensili AS pti_mensili
	  FROM Clienti
	  JOIN Nuclei_Familiari ON Nuclei_Familiari.Cod_Fam=Clienti.Cod_Fam
	  JOIN Appuntamenti ON Appuntamenti.Id_Cl=Clienti.Cod_Fisc
	  JOIN ProdottiUscita ON ProdottiUscita.Cod_App=Appuntamenti.Cod_App
	  JOIN Inventario ON Inventario.Cod_Prod=ProdottiUscita.Cod_Prod AND Inventario.Data_Scad=ProdottiUscita.Data_Scad
	  WHERE extract(
    		year FROM Appuntamenti.Data_ora )= extract(
    		year FROM current_timestamp)
	  ) AS ragg_punti
GROUP BY famiglia, pti_mensili;


--la percentuale di punti utilizzata per prodotti deperibili e non deperibili nell’ultimo anno;
CREATE OR REPLACE VIEW infofamiglia11 AS
SELECT famiglia, sum(Punti_spesi) AS punti_annui_spesi_deperibili
FROM (SELECT  Clienti.Cod_Fam AS famiglia , (Inventario.Num_Punti)*(ProdottiUscita.Quantità) AS Punti_spesi, Nuclei_Familiari.punti_mensili AS pti_mensili
	  FROM Clienti
	  JOIN Nuclei_Familiari ON Nuclei_Familiari.Cod_Fam=Clienti.Cod_Fam
	  JOIN Appuntamenti ON Appuntamenti.Id_Cl=Clienti.Cod_Fisc
	  JOIN ProdottiUscita ON ProdottiUscita.Cod_App=Appuntamenti.Cod_App
	  JOIN Inventario ON Inventario.Cod_Prod=ProdottiUscita.Cod_Prod AND Inventario.Data_Scad=ProdottiUscita.Data_Scad
	  WHERE extract(year FROM Appuntamenti.Data_ora )= extract(year FROM current_timestamp)
	  	AND inventario.deperibile
	  ) AS ragg_punti
GROUP BY famiglia, pti_mensili;

--punti anni spesi di prodotti non deperibili
CREATE OR REPLACE VIEW infofamiglia12 AS
SELECT famiglia, sum(Punti_spesi) AS punti_annui_spesi_non_deperibili
FROM (SELECT  Clienti.Cod_Fam AS famiglia , (Inventario.Num_Punti)*(ProdottiUscita.Quantità) AS Punti_spesi, Nuclei_Familiari.punti_mensili AS pti_mensili
	  FROM Clienti
	  JOIN Nuclei_Familiari ON Nuclei_Familiari.Cod_Fam=Clienti.Cod_Fam
	  JOIN Appuntamenti ON Appuntamenti.Id_Cl=Clienti.Cod_Fisc
	  JOIN ProdottiUscita ON ProdottiUscita.Cod_App=Appuntamenti.Cod_App
	  JOIN Inventario ON Inventario.Cod_Prod=ProdottiUscita.Cod_Prod AND Inventario.Data_Scad=ProdottiUscita.Data_Scad
	  WHERE extract(year FROM Appuntamenti.Data_ora )= extract(year FROM current_timestamp)
	  	AND NOT inventario.deperibile
	  ) AS ragg_punti
GROUP BY famiglia, pti_mensili;

-- percentuale prodotti deperibili e non
CREATE OR REPLACE VIEW infofamiglia13 AS
SELECT infofamiglia10.famiglia, infofamiglia10.punti_annui_spesi ,
		coalesce((infofamiglia11.punti_annui_spesi_deperibili)/(infofamiglia10.punti_annui_spesi)*100,0) AS percentuale_prod_dep,
		coalesce((infofamiglia12.punti_annui_spesi_non_deperibili)/(infofamiglia10.punti_annui_spesi)*100,0) AS percentuale_prod_non_dep
FROM infofamiglia10
left JOIN infofamiglia11 ON infofamiglia10.famiglia=infofamiglia11.famiglia
left JOIN infofamiglia12 ON infofamiglia10.famiglia=infofamiglia12.famiglia;

/*tabella con tutte informazioni insieme*/

CREATE OR REPLACE VIEW infofamigliafinale AS
SELECT distinct *
FROM infofamiglia01
natural JOIN infofamiglia09
natural JOIN infofamiglia05
natural JOIN infofamiglia06
natural JOIN infofamiglia08
natural JOIN infofamiglia10
natural JOIN infofamiglia13 ;


/********************************************************************************************/
/*QUEERY*/
--a
--determinare i nuclei familiari che, pur avendo punti assegnati, non hanno effettuato spese nell’ultimo mese
CREATE TABLE queery1 AS
SELECT distinct famiglia
FROM infofamiglia02
ORDER BY famiglia ASC;

--b
--determinare le tipologie di prodotti acquistate nell’ultimo anno da tutte le famiglie (cioè ogni famiglia ha acquistato almeno un prodotto di tale tipologia nell’ultimo anno);
CREATE OR REPLACE VIEW tipologie_uscita AS
SELECT distinct tipologia, prodottiuscita.cod_prod
FROM inventario
JOIN prodottiuscita ON inventario.cod_prod=prodottiuscita.cod_prod AND inventario.data_scad=prodottiuscita.data_scad;

--codice della famiglia e la tipologia di cio' che hanno comprato
CREATE OR REPLACE VIEW famiglia_acq_anno AS
SELECT distinct Clienti.cod_fam AS cod_fam,tipologia
FROM appuntamenti
JOIN prodottiuscita ON  prodottiuscita.cod_app=appuntamenti.cod_app
JOIN inventario ON inventario.cod_prod=prodottiuscita.cod_prod AND inventario.data_scad=prodottiuscita.data_scad
JOIN Clienti ON appuntamenti.id_cl=Clienti.cod_fisc
JOIN Nuclei_familiari ON Nuclei_familiari.cod_fam=Clienti.cod_fam
WHERE extract(year FROM Appuntamenti.Data_ora )= extract(year FROM current_timestamp);

--numeri tipologia acquisto
CREATE OR REPLACE VIEW num_tip_acq AS
SELECT tipologia,count (tipologia) AS numero_fam_acq FROM famiglia_acq_anno
GROUP BY famiglia_acq_anno.tipologia;

CREATE TABLE queery2 AS
SELECT tipologia FROM num_tip_acq
WHERE numero_fam_acq=(SELECT count(*) FROM nuclei_familiari);


--c
--determinare i prodotti che vengono scaricati (cioè non riescono ad essere distribuiti alle famiglie) in quantitativo maggiore rispetto al quantitativo medio scaricato per prodotti della loro tipologia

-- calcolo la quantità dei prodotti in uscita
--conteggio prodotti residui che non vengono scaricati
-- conto per tipologia il totale dei prodotti rimasti e quanti tipi di prodotto esistono
--Ritorno la queery richiesta

CREATE TABLE Queery3 AS
SELECT pns.Cod_Prod, pns.Data_Scad, (cnt.tot / cnt.num) AS media, pns.quantità_residua
FROM (
    SELECT i.Cod_Prod, i.Data_Scad, (i.quantità - pu.quantità_uscita) AS quantità_residua, i.tipologia
    FROM Inventario i
    JOIN (
        SELECT Cod_Prod, Data_Scad, SUM(quantità) AS quantità_uscita
        FROM ProdottiUscita
        GROUP BY Cod_Prod, Data_Scad
    ) pu ON i.Cod_Prod = pu.Cod_Prod AND i.Data_Scad = pu.Data_Scad
) pns
JOIN (
    SELECT tipologia, SUM(quantità_residua) AS tot, COUNT(*) AS num
    FROM (
        SELECT i.Cod_Prod, i.Data_Scad, (i.quantità - pu.quantità_uscita) AS quantità_residua, i.tipologia
        FROM Inventario i
        JOIN (
            SELECT Cod_Prod, Data_Scad, SUM(quantità) AS quantità_uscita
            FROM ProdottiUscita
            GROUP BY Cod_Prod, Data_Scad
        ) pu ON i.Cod_Prod = pu.Cod_Prod AND i.Data_Scad = pu.Data_Scad
    ) pns
    GROUP BY tipologia
) cnt ON pns.tipologia = cnt.tipologia
WHERE (cnt.tot / cnt.num) < pns.quantità_residua AND (cnt.tot / cnt.num) > 0;



/*FUNZIONI*/
--a
--funzione che realizza lo scarico dall’inventario dei prodotti scaduti;

--essendo che i prodotti in inventario sono chiave per i prodotti in entrata e uscita 
--setto solo la loro quantità a 0, dopodichè andrò a inserire i prodotti nella tabella scaricoprodotti
CREATE FUNCTION ScaricoProdottiScaduti()
RETURNS VOID
AS $$
BEGIN
    INSERT INTO ScaricoProdotti (Cod_Prod, Data_Scad, DataScar, Quantità)
    SELECT Cod_Prod, Data_Scad, CURRENT_DATE, 0
    FROM Inventario
    WHERE Data_Scad < CURRENT_DATE;
	-- setto la quantità in inventario a 0
    UPDATE Inventario
    SET Quantità = 0
    WHERE Data_Scad < CURRENT_DATE;
END;
$$ LANGUAGE plpgsql;

-- PER TESTARE FUNZIONE
--SELECT* FROM inventario;
--Insert into Inventario values('SalsaAgromonte','11/25/2022',6,1,'11/25/2021','mozzarella');
--SELECT ScaricoProdottiScaduti();
--SELECT * FROM scaricoprodotti;

--b
--dato un volontario e due date, determinare i turni assegnati al volontario nel periodo compreso tra le due date.
CREATE OR REPLACE FUNCTION determina_turni_volontario(volontario_id VARCHAR(20), data_inizio TIMESTAMP, data_fine TIMESTAMP)
RETURNS TABLE (cod VARCHAR(20), data_turno TIMESTAMP) AS $$
BEGIN
    RETURN QUERY
    SELECT Id_Vol, Data_ora
    FROM Appuntamenti
    WHERE Id_Vol = volontario_id
        AND Data_ora >= data_inizio
        AND Data_ora <= data_fine;
END;
$$ LANGUAGE plpgsql;

-- PER TESTARE FUNZIONE
--SELECT determina_turni_volontario('BRDDMNA25B347TGT', '01/01/2023 00:00:00', '12/30/2023 00:00:00');


/**********************************************************************/
/*TRIGGER*/
-- verifica del vincolo di disponibilità dei volontari
CREATE OR REPLACE FUNCTION disponibilita_volontari()
RETURNS TRIGGER AS $$
BEGIN
    -- Controlla se il volontario è già assegnato a un'altra attività contemporanea
    IF EXISTS (
        SELECT 1
        FROM Appuntamenti
        WHERE Id_Vol = NEW.Id_Vol
          AND Cod_App <> NEW.Cod_App
          AND (Data_ora, Data_ora) OVERLAPS (NEW.Data_ora, NEW.Data_ora)
    ) THEN RAISE EXCEPTION 'Il volontario è già assegnato ad un altro appuntamento nello stesso giorno e orario';
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- trigger
CREATE TRIGGER disponibilita_volontari
BEFORE INSERT OR UPDATE ON Appuntamenti
FOR EACH ROW
EXECUTE FUNCTION disponibilita_volontari();

--Prova del trigger
--INSERT INTO Appuntamenti VALUES ('ap000049','08/20/2023 09:00:00','RSSLSN80R09L219E','MGGNCL00B24D969E');


-- mantenimento della disponibilità corrente dei prodotti.
CREATE OR REPLACE FUNCTION disponibilita_prodotto()
RETURNS TRIGGER AS $$
BEGIN
    -- Aggiorna la quantità disponibile del prodotto in base alle quantità dei prodotti usciti
    UPDATE Inventario
    SET Quantità = Quantità - NEW.Quantità
    WHERE Cod_Prod = NEW.Cod_Prod AND Data_Scad = NEW.Data_Scad;
    -- Controlla se la quantità disponibile del prodotto è inferiore a 0 dopo l'aggiornamento
    IF (SELECT Quantità FROM Inventario WHERE Cod_Prod = NEW.Cod_Prod AND Data_Scad = NEW.Data_Scad) < 0 THEN
        RAISE EXCEPTION 'La quantità disponibile del prodotto negativa';
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- trigger
CREATE TRIGGER disponibilita_prodotto_trigger
AFTER INSERT ON ProdottiUscita
FOR EACH ROW
EXECUTE FUNCTION disponibilita_prodotto();

-- Prova del trigger 
--INSERT INTO ProdottiUscita VALUES ('ap000048','OlioDante','12/15/2023',30);